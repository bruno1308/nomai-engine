# Week 7-8: End-to-End Integration + Demo (Issues #41-#45)

> **For Claude:** Use subagent-driven-development to implement task-by-task.

**Goal:** Complete the MVP by building `demo_breakout.py`, proving the verification thesis end-to-end.

**Architecture:** Python orchestration drives the Rust engine (via PyO3), loads WASM gameplay modules, runs verification against intent specs, and produces structured reports. The demo uses a buggy → fixed module progression.

**Tech Stack:** Python 3.12, PyO3, AssemblyScript 0.27, existing nomai-sdk

---

### Task 1: Create Buggy Breakout WASM Module

**Files:**
- Create: `gameplay/assembly/breakout_buggy.ts`
- Modify: `gameplay/package.json` (add build:buggy script)

The buggy module has the same structure as `breakout.ts` but with deliberate bugs:
- `handleBrickHit()` does NOT call `despawn_entity()` (brick stays alive)
- `handleBrickHit()` does NOT emit the `brick_destroyed` event
- Score still increments (partial correctness)

Build script: `npx asc assembly/breakout_buggy.ts --outFile build/breakout_buggy.wasm --optimize --exportRuntime`

Compile both: `npm run build && npm run build:buggy`

### Task 2: Write `demo_breakout.py`

**Files:**
- Create: `demo_breakout.py` (project root)

The demo script implements the full verification loop from v8 spec Section 11:

1. **Setup:** Create engine, register components, spawn entities (paddle, ball, 20 bricks) with semantic identities, set up physics
2. **Load buggy WASM:** Load `gameplay/build/breakout_buggy.wasm`
3. **Run 1 (Buggy):** Run 600 ticks → collect manifests → verify with `build_breakout_suite()` → print failures with diagnosis
4. **Hot-swap to fixed WASM:** Load `gameplay/build/gameplay.wasm`
5. **Restore snapshot:** Restore to pre-simulation state
6. **Run 2 (Fixed):** Run 600 ticks → collect manifests → verify → print passes
7. **Regression tests:** Save regression tests from passing run
8. **Run regression tests:** Replay and verify regression tests pass
9. **Output:** Structured report showing the full cycle

### Task 3: Build Infrastructure

**Files:**
- Modify: `justfile` (add demo, build-python targets)
- Create: `crates/nomai-python/pyproject.toml` (maturin config)

Add justfile targets:
- `build-python`: Build the PyO3 native module and install into nomai-sdk
- `demo`: Build everything then run `demo_breakout.py`

### Task 4: Write README.md

**Files:**
- Create: `README.md` (project root)

Cover:
- Project overview (the verification thesis)
- Build prerequisites (Rust 1.83, Python 3.12, Node.js for AS)
- Build instructions (`just build`, `just build-gameplay`, `just build-python`)
- How to run the demo (`just demo`)
- How to run tests (`just test`)
- Architecture overview
- Performance targets

### Task 5: End-to-End Verification + Polish

- Run `just demo` and verify output
- Run `just ci` and verify clean
- Check Rust LOC < 10K, Python LOC < 3K
- Clean up any warnings
- Commit and PR

### Task 6: Close Issues #41-#45
